<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caída libre con resistencia</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-6">
    <div class="max-w-5xl mx-auto">
        <h1 class="text-2xl font-bold mb-4">Caída libre con resistencia - Métodos de Heun y RK4</h1>
        <button onclick="resolver()"
            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Resolver</button>

        <div class="mt-8">
            <canvas id="grafico"></canvas>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
            <div>
                <h2 class="text-lg font-semibold mb-2">Tabla - Heun</h2>
                <table class="table-auto w-full text-sm border">
                    <thead>
                        <tr>
                            <th class="border px-2">t</th>
                            <th class="border px-2">v</th>
                        </tr>
                    </thead>
                    <tbody id="tablaHeun"></tbody>
                </table>
            </div>
            <div>
                <h2 class="text-lg font-semibold mb-2">Tabla - RK4</h2>
                <table class="table-auto w-full text-sm border">
                    <thead>
                        <tr>
                            <th class="border px-2">t</th>
                            <th class="border px-2">v</th>
                        </tr>
                    </thead>
                    <tbody id="tablaRK4"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const m = 5; // kg
        const g = 9.81; // m/s²
        const k = 0.05; // kg/m
        const v0 = 0;
        const t0 = 0;
        const tf = 15;
        const h = 1;
        const n = Math.floor((tf - t0) / h);

        function f(t, v) {
            return (-m * g + k * v * v) / m;
        }

        function heunMethod() {
            const res = [[t0, v0]];
            for (let i = 1; i <= n; i++) {
                const t = t0 + (i - 1) * h;
                const y = res[i - 1][1];
                const pred = y + h * f(t, y);
                const corr = y + (h / 2) * (f(t, y) + f(t + h, pred));
                res.push([t + h, corr]);
            }
            return res;
        }

        function rk4Method() {
            const res = [[t0, v0]];
            for (let i = 1; i <= n; i++) {
                const t = t0 + (i - 1) * h;
                const y = res[i - 1][1];
                const k1 = h * f(t, y);
                const k2 = h * f(t + h / 2, y + k1 / 2);
                const k3 = h * f(t + h / 2, y + k2 / 2);
                const k4 = h * f(t + h, y + k3);
                const yNext = y + (1 / 6) * (k1 + 2 * k2 + 2 * k3 + k4);
                res.push([t + h, yNext]);
            }
            return res;
        }

        function llenarTabla(id, datos) {
            const tbody = document.getElementById(id);
            tbody.innerHTML = "";
            for (const [t, v] of datos) {
                const fila = `<tr><td class='border px-2'>${t.toFixed(2)}</td><td class='border px-2'>${v.toFixed(4)}</td></tr>`;
                tbody.innerHTML += fila;
            }
        }

        function graficar(datosHeun, datosRK4) {
            const ctx = document.getElementById('grafico').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: datosHeun.map(([t]) => t),
                    datasets: [
                        {
                            label: 'Heun',
                            data: datosHeun.map(([, v]) => v),
                            borderColor: 'rgb(59, 130, 246)',
                            fill: false,
                        },
                        {
                            label: 'RK4',
                            data: datosRK4.map(([, v]) => v),
                            borderColor: 'rgb(34, 197, 94)',
                            fill: false,
                        },
                    ]
                }
            });
        }

        function resolver() {
            const heun = heunMethod();
            const rk4 = rk4Method();
            llenarTabla("tablaHeun", heun);
            llenarTabla("tablaRK4", rk4);
            graficar(heun, rk4);
        }
    </script>
</body>

</html>